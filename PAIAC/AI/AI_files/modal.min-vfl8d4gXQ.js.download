define(["require","exports","tslib","react","classnames","external/lodash","modules/clean/analytics","modules/clean/auth/login/form","modules/clean/auth/login_or_register/types","modules/clean/auth/register/form","modules/clean/auth/register/types","modules/clean/auth_event_logger","modules/clean/growth/experiments/logger","modules/clean/react/comments2/data/logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/welcome_modal","modules/constants/file_viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","spectrum/button","spectrum/modal","modules/clean/auth/common/stats","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/file_viewer/conversions/conversion_utils"],(function(e,o,t,n,a,i,r,s,l,c,d,u,m,g,p,f,_,h,v,M,E,O,C,L,S,D,N,w){"use strict";var b;Object.defineProperty(o,"__esModule",{value:!0}),n=t.__importDefault(n),a=t.__importDefault(a),m=t.__importDefault(m),g=t.__importStar(g),M=t.__importStar(M);var y=((b={})[l.CommentTextVariant.DEFAULT]="default-variant",b[l.CommentTextVariant.POST]="post-comment-variant",b[l.CommentTextVariant.SUBSCRIBE]="subscribe-variant",b);o.TestOnlyCommentTextVariantCssClass=y,o.DefaultHeaderContent=function(e){var o=e.mode,t=e.onHeaderLinkClick,a=o===l.Mode.LOGIN?O._("Download and save directly to your Dropbox by signing in, or <a>create a free account</a>"):O._("Download and save to your Dropbox by creating a free account, or <a>sign in</a>"),i=o===l.Mode.LOGIN?O._("Save it for later in your Dropbox account, or <a>create a free account</a>"):O._("Save it for later with Dropbox, or <a>sign in </a>"),r=o===l.Mode.LOGIN?O._("Save it for later in your Dropbox account"):O._("Save it for later in Dropbox"),s="SIGNUP_MODAL_TTL_24H_WITH_COPY_CHANGES"===v.PREVIEWS_CONVERSION_EXPERIMENTS?i:w.shouldShowSimplifiedModal()?r:a;return n.default.createElement("div",{className:"modal-header"},w.shouldShowSimplifiedModal()&&n.default.createElement(N.DropboxLogo,{className:"modal-header__dropbox-logo"}),n.default.createElement("span",null,_.reactFormat(s,{a:function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return(n.default.createElement(L.Button,{className:"button-as-link toggle-form-link",onClick:t,variant:"styleless"},e))}})))},o.ExperimentalToggleMessage=function(e){var o=e.mode,t=e.onHeaderLinkClick,a=o===l.Mode.LOGIN?O._("Sign in or <a>create an account</a>"):O._("Sign up or <a>sign in to your account</a>");return n.default.createElement(n.default.Fragment,null,n.default.createElement("span",null,_.reactFormat(a,{a:function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return(n.default.createElement(L.Button,{className:"button-as-link toggle-form-link",onClick:t,variant:"styleless"},e))}})))};var T=function(e){var o,t=e.className,a=e.commentTextVariant,i=e.mode;switch(a){case l.CommentTextVariant.POST:o=i===l.Mode.LOGIN?O._("To post your comment, sign in to Dropbox."):O._("To post your comment, create a free Dropbox account.");break;case l.CommentTextVariant.SUBSCRIBE:o=i===l.Mode.LOGIN?O._("To subscribe to this file, sign in to Dropbox."):O._("To subscribe to this file, create a free Dropbox account.");break;default:o=i===l.Mode.LOGIN?O._("To continue, sign in to Dropbox."):O._("To continue, create a free Dropbox account.")}return n.default.createElement("div",{className:"text-variant "+t},o)};o.TestOnlyCommentsHeader=T;var k=function(e){var o=e.mode,t=e.onFooterLinkClick;return n.default.createElement(L.Button,{className:"button-as-link",onClick:t,variant:"styleless"},o===l.Mode.LOGIN?O._("New to Dropbox? Create a free account!"):O._("Have a Dropbox account? Sign in."))};o.DefaultFooterContent=function(e){var o=e.isDownload,t=e.onFooterLinkClick;return n.default.createElement(L.Button,{className:"button-as-link close-link",onClick:t,variant:"styleless"},o?O._("No thanks, continue to download"):O._("No thanks, continue to view"))};var R=(function(e){function p(t){var a=e.call(this,t)||this;return a.logWebActivityOnce=i.once((function(e){r.WebMiscActivityLogger.log(e,{auth_google:!0})})),a.logAuthIntent=function(){a.state.mode===l.Mode.LOGIN?u.AuthEventLogger.log_web_login_intent():u.AuthEventLogger.log_web_signup_intent()},a.renderHeader=function(){if(a.state.isThirdPartyRegistrationContinuation)return n.default.createElement("div",{className:"mc-util-modal-header center"},n.default.createElement("h1",null,O._("Create account and continue")));var e=a.props,t=e.commentParams,i=e.customHeaderContent,r=e.kind;if(i){var s=i;return n.default.createElement(s,{mode:a.state.mode,changeMode:a.toggleMode})}return n.default.createElement("div",{className:"mc-util-modal-header center"},r===l.LoginOrRegisterKind.COMMENT?n.default.createElement(T,{className:y[t.variant],commentTextVariant:t.variant,mode:a.state.mode}):n.default.createElement(o.DefaultHeaderContent,{mode:a.state.mode,onHeaderLinkClick:a.toggleMode}))},a.renderFooter=function(){var e=a.props,t=e.kind,i=e.customFooterContent,r=e.downloadAction;if(i){var s=i;return n.default.createElement(s,null)}return n.default.createElement("div",{className:"mc-util-modal-actions"},t===l.LoginOrRegisterKind.COMMENT?n.default.createElement(k,{mode:a.state.mode,onFooterLinkClick:a.toggleMode}):n.default.createElement(o.DefaultFooterContent,{isDownload:t===l.LoginOrRegisterKind.DOWNLOAD&&r===l.DownloadAction.DIRECT_DOWNLOAD,onFooterLinkClick:a.onContinueToView}))},a.toggleMode=function(e){e.preventDefault(),a.setState((function(e){if(a.props.kind===l.LoginOrRegisterKind.COMMENT){var o=e.mode===l.Mode.LOGIN?"sign_up_modal_toggle_to_sign_up":"sign_up_modal_toggle_to_sign_in";g.logEvent(o,{stream:a.props.commentParams.stream})}return{mode:e.mode===l.Mode.LOGIN?l.Mode.REGISTER:l.Mode.LOGIN}}),a.logAuthIntent)},a.onAuthenticateSuccess=function(e,o){var t=a.state.mode,i=a.props,r=i.downloadAction,s=i.kind;if(t===l.Mode.LOGIN?C.Notify.success(O._("Successfully signed in to Dropbox")):C.Notify.success(O._("Successfully signed up for Dropbox")),a.props.kind===l.LoginOrRegisterKind.COMMENT){var c=t===l.Mode.LOGIN?"sign_up_modal_sign_in_success":"sign_up_modal_sign_up_success";g.logEvent(c,{stream:a.props.commentParams.stream})}if(a.props.onAuthenticateSuccess(e),s===l.LoginOrRegisterKind.IMMEDIATE||r===l.DownloadAction.DIRECT_DOWNLOAD)if(t===l.Mode.REGISTER){if(o.force_redirect_url&&o.redirect_url)return M.redirect(o.redirect_url);m.default.log("sharing","shared_link_welcome_modal_view"),f.Modal.showInstance(n.default.createElement(h.WelcomeModal,{id:"shared-link-welcome-modal"}))}else t===l.Mode.LOGIN&&M.reload();else a.closeModal()},a.onContinueToView=function(e){e.preventDefault(),e.stopPropagation(),a.props.onContinueToView&&a.props.onContinueToView(),a.logLoginOrRegisterModalDismissed(),a.closeModal()},a.logLoginOrRegisterModalDismissed=function(){var e=a.props.kind;a.state.mode===l.Mode.REGISTER?D.AuthUXAnalyticsLogger.logSignupModalDismissed(e||void 0):D.AuthUXAnalyticsLogger.logLoginModalDismissed(e||void 0)},a.onCancel=function(e){e&&e.stopPropagation(),a.logLoginOrRegisterModalDismissed(),a.props.onCancel(),a.closeModal()},a.closeModal=function(e){e&&e.stopPropagation(),f.Modal.close(null)},a.state={mode:t.initialMode||l.Mode.LOGIN,isThirdPartyRegistrationContinuation:!1},E.assert(!(t.kind===l.LoginOrRegisterKind.COMMENT&&!t.commentParams),"Comment parameters must be provided if calling this modal from comments code"),a}return t.__extends(p,e),p.prototype.componentDidMount=function(){var e=this.props,o=e.downloadAction,t=e.kind,n=e.initialMode;this.logAuthIntent(),t===l.LoginOrRegisterKind.IMMEDIATE?this.logWebActivityOnce("signup_modal-show-upfront"):t===l.LoginOrRegisterKind.DOWNLOAD&&o===l.DownloadAction.DIRECT_DOWNLOAD&&this.logWebActivityOnce("signup_modal-show-download"),n===l.Mode.LOGIN?D.AuthUXAnalyticsLogger.logLoginModalShown(t||void 0):D.AuthUXAnalyticsLogger.logSignupModalShown(t||void 0)},p.prototype.render=function(){var e=this,t=this.state.mode,i=this.props,r=i.id,u=i.signup_tag,m=i.showGoogleRegistration,g=i.customHeaderContent,p=i.customFooterContent;return n.default.createElement(S.Modal,{ariaLabel:"Login or register modal",appElement:document.body,bodyId:r,className:a.default("mc-util-modal mc-util-modal-regular login-or-register-modal",{"conversion-experiment":w.shouldShowSimplifiedModal()}),displayCloseButton:!0,onRequestClose:this.onCancel,open:!0,overlayClassName:"file-viewer-modal-overlay",width:w.shouldShowSimplifiedModal()?400:500},this.renderHeader(),n.default.createElement("div",{className:"mc-util-modal-body"},w.shouldShowSimplifiedModal()&&!g&&n.default.createElement(o.ExperimentalToggleMessage,{mode:this.state.mode,onHeaderLinkClick:this.toggleMode}),t===l.Mode.LOGIN&&n.default.createElement(s.LoginForm,{canRedirect:!1,className:"login-form-wrapper",googleLoginProps:w.shouldShowSimplifiedModal()?{positionBelow:!0}:{positionBelow:!1},appleLoginProps:w.shouldShowSimplifiedModal()?{positionBelow:!0}:{positionBelow:!1},maestroStyle:!w.shouldShowSimplifiedModal(),onLoginSuccess:this.onAuthenticateSuccess,rememberMeCheckboxProps:{checked:!0},encryptionOptions:this.props.encryptionOptions}),t===l.Mode.REGISTER&&n.default.createElement(c.RegisterForm,{additionalParams:u?{signup_tag:u}:void 0,canRedirect:!1,className:"register-form-wrapper",maestroStyle:!w.shouldShowSimplifiedModal(),onRegisterSuccess:this.onAuthenticateSuccess,tosCheckboxProps:{inline:!1},googleRegisterProps:m?{position:"BOTTOM"}:void 0,onRegisterFormEvent:function(o){o===d.RegisterFormEvent.GOOGLE_REGISTER_SUCCESS&&e.setState({isThirdPartyRegistrationContinuation:!0})}})),(!w.shouldShowSimplifiedModal()||p)&&this.renderFooter())},p})(n.default.PureComponent);o.TestOnlyLoginOrRegisterModal=R;var I=p.requireCssWithComponent(R,["/static/css/components/login_or_register_modal-vfl4dP97Y.css","/static/css/legacy_packages/components-vflL6NIoo.css","/static/css/components/button-vfloOTIBW.css","/static/css/scooter/scooter-scoped-vfljL5ijS.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"]);o.LoginOrRegisterModal=I}));
//# sourceMappingURL=modal.min.js-vfly0Dtk3.map